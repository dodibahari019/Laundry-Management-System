APP_NAME=Laravel
APP_ENV=local
APP_KEY=base64:uYh/66mIW4FKu77esCD96veZx2l4R6h/Q6XkCS7v0Dk=
APP_DEBUG=true
APP_URL=http://localhost

APP_LOCALE=en
APP_FALLBACK_LOCALE=en
APP_FAKER_LOCALE=en_US

APP_MAINTENANCE_DRIVER=file
# APP_MAINTENANCE_STORE=database

# PHP_CLI_SERVER_WORKERS=4

BCRYPT_ROUNDS=12

LOG_CHANNEL=stack
LOG_STACK=single
LOG_DEPRECATIONS_CHANNEL=null
LOG_LEVEL=debug

DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=laundry_db
DB_USERNAME=root
DB_PASSWORD=

SESSION_DRIVER=file
SESSION_LIFETIME=120
SESSION_ENCRYPT=false
SESSION_PATH=/
SESSION_DOMAIN=null

BROADCAST_CONNECTION=log
FILESYSTEM_DISK=local
QUEUE_CONNECTION=database

CACHE_STORE=database
# CACHE_PREFIX=

MEMCACHED_HOST=127.0.0.1

REDIS_CLIENT=phpredis
REDIS_HOST=127.0.0.1
REDIS_PASSWORD=null
REDIS_PORT=6379

MAIL_MAILER=log
MAIL_SCHEME=null
MAIL_HOST=127.0.0.1
MAIL_PORT=2525
MAIL_USERNAME=null
MAIL_PASSWORD=null
MAIL_FROM_ADDRESS="hello@example.com"
MAIL_FROM_NAME="${APP_NAME}"

AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_DEFAULT_REGION=us-east-1
AWS_BUCKET=
AWS_USE_PATH_STYLE_ENDPOINT=false

Tambah konfigurasi & env:

.env: PAYMENT_PROVIDER=midtrans (contoh), PAYMENT_KEY=xxxx, PAYMENT_SECRET=xxxx, PAYMENT_MODE=sandbox
Buat config/payment.php membaca env di atas.
Buat PaymentController:

Metode checkout(Request $req): buat request ke provider, simpan/ubah tb_pembayaran (set gateway, gateway_transaction_id jika ada, status = pending), kembalikan redirect URL / payment token ke frontend.

Metode callback(Request $req): route yang user dikembalikan setelah pembayaran (opsional, tampilkan hasil).

Metode webhook(Request $req): menerima notifikasi provider; verifikasi signature; bandingkan amount dengan tb_pembayaran.jumlah atau tb_orders.total; update status, amount_paid, paid_at, raw_response; jika paid set tb_orders.status_order atau payment_status sesuai kebijakan dan buat entry OrderStatusLog.

Webhook tidak pakai CSRF dan harus memverifikasi signature/secret header.

Routes:

Tambah endpoints (disarankan: routes/api.php untuk webhook):
POST /payment/checkout -> PaymentController@checkout
GET /payment/callback -> PaymentController@callback
POST /payment/webhook -> PaymentController@webhook (exclude CSRF)
Jika tetap di web.php, pastikan men-disallow CSRF pada middleware VerifyCsrfToken untuk route webhook.
Ubah alur OrderController::store():

Untuk metode online, setelah buat Orders tetap buat Pembayaran namun set status = pending dan jumlah = expected total; jangan tandai paid sampai webhook.
Pindahkan panggilan ke provider ke PaymentController@checkout sehingga flow lebih modular.
Keamanan & verifikasi:

Verifikasi signature/tanda tangan webhook provider.
Cocokkan amount di payload dengan orders.total.
Log raw_response untuk audit.
Gunakan HTTPS di lingkungan produksi.
Testing:

Uji di sandbox provider: checkout → redirect → kirim payload webhook simulasi → cek DB update.
Tambah feature tests untuk webhook handler.
Opsional (nilai tambah):

Buat tabel tb_payment_transactions nanti jika butuh multiple attempts/history per order.
Notifikasi email/in-app saat status berubah.
Dashboard admin untuk melihat transaksi (gabungkan di Report/Export jika perlu).
Jika setuju dengan pendekatan menambah kolom ke tb_pembayaran, saya bisa:

membuat migration file dan contoh PaymentController stub + route changes, atau
hanya buat migration dan update model sekarang.
Mau saya mulai dengan membuat migration + update Pembayaran model (pilih ya), lalu saya terapkan perubahan?



VITE_APP_NAME="${APP_NAME}"
